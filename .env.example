# ==============================================================================
# GeneGnome Environment Configuration Example
# ==============================================================================
# Description: Environment variables for GeneGnome genetics processing platform
# Author: Matthew Barham
# Created: 2025-11-20
# License: Apache-2.0 OR MIT
# ==============================================================================
# IMPORTANT: Copy this file to `.env` and update with your actual values
#
# SECURITY WARNING:
#   - NEVER commit .env files to version control
#   - Store sensitive values (passwords, secrets) in Docker secrets
#   - See docs/ for comprehensive setup guide
# ==============================================================================

#==============================================================================
# SYSTEM CONFIGURATION
#==============================================================================

# Project directory (absolute path where you cloned the repository)
GENEGNOME_DIR=/opt/genegnome

# Docker configuration directory (usually same as GENEGNOME_DIR)
DOCKERDIR=${GENEGNOME_DIR}

# Timezone for container logs and scheduling
TZ=America/New_York

# System time reference (leave as /etc/localtime)
LOCALTIME=/etc/localtime

# Server hostname (used for Docker image tags)
HOSTNAME=your-server
HOSTNAME_L=your-server-lowercase

# User and group IDs for container permissions
PUID=1000              # Your user ID (run `id -u` to find)
DGID=1000              # Your docker group ID (run `getent group docker | cut -d: -f3`)
USERNAME=your-username # Your system username

# Admin contact information
ADMIN_NAME='Your Name'
ADMIN_EMAIL='admin@your-domain.com'
SERVICES_EMAIL='noreply@your-domain.com'

# Domain configuration
DOMAIN=your-domain.com  # Your public domain name

# Build date (auto-generated, leave as-is)
BUILD_DATE=$(date +%Y-%m-%d)

#==============================================================================
# DOCKER IMAGE VERSIONS
#==============================================================================
# NOTE: Check GitHub releases for latest stable versions

GENETICS_API_VERSION=1.0.0
GENETICS_WORKER_VERSION=1.0.0
GENETICS_FRONTEND_VERSION=1.0.0
POSTGRES_GENETICS_VERSION=17.6
REDIS_VERSION=8.2.2-alpine

#==============================================================================
# DATABASE CONFIGURATION
#==============================================================================

# PostgreSQL database name and user
POSTGRES_GENETICS_DB=genetics
POSTGRES_GENETICS_USER=genetics_api

# SECURITY: Database password stored in Docker secrets
# Create secret file at: ${GENEGNOME_DIR}/secrets/genetics/genetics_psql_password
# Generate with: openssl rand -base64 32 > secrets/genetics/genetics_psql_password
POSTGRES_GENETICS_PASSWORD=PLACEHOLDER_CHANGE_ME

# Localhost port mappings (for development/debugging via localhost)
GENETICS_POSTGRES_PORT=5436  # External port for PostgreSQL
GENETICS_REDIS_PORT=6380     # External port for Redis

#==============================================================================
# SERVICE CONFIGURATION
#==============================================================================

# API Gateway settings
GENETICS_API_PORT=8080
GENETICS_API_EXTERNAL_PORT=8090  # External port for API access
GENETICS_LOG_LEVEL=info          # Log level: trace, debug, info, warn, error

#==============================================================================
# NETWORK CONFIGURATION
#==============================================================================
# Internal Docker network IPs (adjust to avoid conflicts on your network)
# Default uses 10.0.10.x range - change if it conflicts with your LAN

GENETICS_FRONTEND_IP=10.0.10.62  # Frontend service IP in proxy network
GENETICS_API_IP=10.0.10.63       # API Gateway IP in proxy network

# Note: Internal services (postgres, redis, worker) use isolated networks
# and do not need public IPs - accessed via container hostnames

#==============================================================================
# REDIS CONFIGURATION
#==============================================================================

REDIS_HOST=genetics-redis  # Container hostname (don't change)
REDIS_PORT=6379            # Internal Redis port (don't change)
REDIS_MAX_MEMORY=1G        # Maximum memory for Redis cache

#==============================================================================
# SECURITY SETTINGS
#==============================================================================

# Session timeout for authenticated users (seconds)
GENETICS_SESSION_TIMEOUT=900  # 15 minutes

# Maximum file upload size (bytes)
GENETICS_MAX_FILE_SIZE=524288000  # 500 MB

# Data retention period (hours) - automatic cleanup after this time
GENETICS_RETENTION_HOURS=72  # 3 days

#==============================================================================
# DATA DIRECTORIES
#==============================================================================

# Encrypted volume for genetic data storage (must be LUKS-encrypted)
# See scripts/setup_encrypted_volume.sh for setup instructions
GENETICS_DATA_DIR=/mnt/genetics-encrypted

# Reference panel data directory (contains reference_panel.db)
GENETICS_REFERENCE_DIR=${GENEGNOME_DIR}/reference

#==============================================================================
# REFERENCE DATA
#==============================================================================

# Reference panel: 50 anonymous genomic samples for ancestry comparison
# Source: Originally from opensnp.github.io (now closed, user-uploaded data)
# Download URL for reference database
REFERENCE_PANEL_URL=http://www.matthewckeller.com/public/VCF.Files3.RData

# Alternative: Michigan Imputation Server (requires registration)
# https://imputationserver.sph.umich.edu/

#==============================================================================
# EMAIL/SMTP CONFIGURATION
#==============================================================================
# Configure email notifications for download links

# SMTP server settings (use your SMTP provider)
SMTP_HOST=smtp.your-provider.com  # SMTP server hostname
SMTP_PORT=587                     # SMTP port (usually 587 for TLS, 465 for SSL)
SMTP_USERNAME=${ADMIN_EMAIL}      # SMTP authentication username
SMTP_USE_TLS=true                 # Enable STARTTLS (port 587)
SMTP_USE_SSL=false                # Enable SSL/TLS (port 465)

# Email sender details
SMTP_FROM_EMAIL=noreply@your-domain.com
SMTP_FROM_NAME=GeneGnome Processing

# SECURITY: SMTP password stored in Docker secrets
# Create secret file at: ${GENEGNOME_DIR}/secrets/smtp/smtp_password

# Download link base URL (user-facing domain)
GENETICS_DOWNLOAD_BASE_URL=https://genome.${DOMAIN}/download

# Email template directory (container path - don't change)
GENETICS_EMAIL_TEMPLATE_DIR=/app/templates/email

#==============================================================================
# DOCKER SECRETS
#==============================================================================
# Create these files in ${GENEGNOME_DIR}/secrets/ directory:
#
# 1. genetics/genetics_psql_password - PostgreSQL password
#    openssl rand -base64 32 > secrets/genetics/genetics_psql_password
#
# 2. genetics/genetics_api_key - API authentication key
#    openssl rand -base64 32 > secrets/genetics/genetics_api_key
#
# 3. genetics/genetics_jwt_secret - JWT token signing secret
#    openssl rand -base64 32 > secrets/genetics/genetics_jwt_secret
#
# 4. smtp/smtp_password - SMTP password for email notifications
#    echo 'your-smtp-password' > secrets/smtp/smtp_password
#
# Set permissions: chmod 600 secrets/*/*
#==============================================================================

#==============================================================================
# SETUP CHECKLIST
#==============================================================================
# Before running `docker-compose up`:
#
# 1. [ ] Copy this file to `.env` and update all values
# 2. [ ] Create encrypted volume: scripts/setup_encrypted_volume.sh
# 3. [ ] Generate all Docker secrets (see section above)
# 4. [ ] Download reference database to ${GENETICS_REFERENCE_DIR}
# 5. [ ] Configure reverse proxy (Traefik, Nginx, etc.)
# 6. [ ] Set up DNS records for your domain
# 7. [ ] Configure SSL/TLS certificates
# 8. [ ] (Optional) Set up authentication provider (Authentik, etc.)
# 9. [ ] Review docs/genetic_data_security_architecture.md
# 10. [ ] Test with example data before processing real genomes
#==============================================================================

#==============================================================================
# ADDITIONAL RESOURCES
#==============================================================================
# Documentation:
#   - README.md - Project overview and quick start
#   - docs/ - Complete documentation
#   - scripts/ - Setup and maintenance scripts
#
# Support:
#   - GitHub Issues: https://github.com/YOUR-USERNAME/GeneGnome/issues
#   - License: Apache-2.0 OR MIT (see LICENSE file)
#==============================================================================
